<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spaceholderz | University for Life Design Studies</title>
    <meta name="description"
        content="Spaceholderz: A University for Life Design studies combining astrology, history, and semiotics to understand the archetypal forces of reality.">
    <link rel="stylesheet" href="static/styles.css">
</head>

<body>

    <header>
        <div class="container">
            <nav>
                <div class="logo">SPACEHOLDERZ</div>
                <a href="#free-guide" class="btn btn-primary" style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">Join
                    Us</a>
            </nav>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <div class="hero-content fade-in">
                <h1>Spaceholderz</h1>
                <p class="subtitle">University for Life Design Studies</p>
                <p>Master the interbeing function that characterizes human evolution.</p>
                <a href="#philosophy" class="btn btn-primary">Discover the Design</a>
            </div>
        </div>
    </section>

    <section id="philosophy" class="philosophy">
        <div class="container">
            <h2>The Numinous Interbeing</h2>
            <p style="max-width: 800px; margin: 0 auto;">
                Our aim is to deeply understand the archetypal forces that underlie conscious life.
                We enable students to connect deeply with the numinous forces within and recognize life's divine design.
            </p>
        </div>
    </section>

    <section class="curriculum">
        <div class="container">
            <h2>The Trinity of Knowledge</h2>
            <p style="text-align: center;">A multidisciplinary curriculum for the modern seeker.</p>

            <div class="modules-grid">
                <div class="module-card">
                    <span class="module-number">01</span>
                    <h3>Astrology</h3>
                    <p>Understand the archetypal forces that underlie conscious life.</p>
                </div>
                <div class="module-card">
                    <span class="module-number">02</span>
                    <h3>History</h3>
                    <p>Study the manifestation of these forces through time.</p>
                </div>
                <div class="module-card">
                    <span class="module-number">03</span>
                    <h3>Semiotics</h3>
                    <p>Explore the fractalic nature of reality through symbols and language.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="free-guide" class="lead-magnet">
        <div class="container">
            <div class="lead-magnet-container">
                <h2>Get the "Astrology 101" PDF</h2>
                <p>Start your journey with our practical primer. Discover the core concepts before the full curriculum
                    begins.</p>

                <form id="leadForm" class="signup-form">
                    <div class="form-group">
                        <label for="email">Your Best Email Address</label>
                        <input type="email" id="email" name="email" placeholder="e.g., student@spaceholderz.edu"
                            required>
                    </div>
                    <div class="gdpr-text">
                        <input type="checkbox" id="gdpr" name="gdpr" required>
                        <label for="gdpr">I agree to receive the free PDF and future updates from Spaceholderz. I
                            understand
                            I can unsubscribe at any time. (GDPR Compliant)</label>
                    </div>
                    <button type="submit" id="submitBtn" class="btn btn-primary"
                        style="width: 100%; margin-top: 1.5rem;">Send My Free
                        Guide</button>
                </form>

                <div id="successState" class="success-message">
                    <h3>âœ¨ Check Your Inbox!</h3>
                    <p style="color: inherit;">A confirmation email is on its way. Please click the link in that email
                        to verify your address and receive your free copy of the guide.</p>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>&copy; 2026 Spaceholderz University. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://absxlbvipopgdqzqkyme.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_QI_kxamETVDcCVVu_VUOug_x3lJfrDi';

        // Use a unique variable name to avoid "Identifier already declared" errors
        // with the Supabase global object from the CDN.
        let astroSupabase;

        try {
            // The CDN typically puts 'supabase' or 'Supabase' in the window.
            const creator = window.supabase?.createClient || window.Supabase?.createClient;
            if (creator) {
                astroSupabase = creator(SUPABASE_URL, SUPABASE_KEY);
            }
        } catch (e) {
            console.error('Supabase initialization failed:', e);
        }

        const leadForm = document.getElementById('leadForm');

        if (leadForm) {
            leadForm.addEventListener('submit', async function (e) {
                // IMMEDIATELY prevent default to stop page reload
                e.preventDefault();
                console.log('Form submission intercepted successfully');

                const emailInput = document.getElementById('email');
                const email = emailInput.value;
                const gdpr = document.getElementById('gdpr').checked;
                const submitBtn = document.getElementById('submitBtn');

                if (email && gdpr && astroSupabase) {
                    submitBtn.disabled = true;
                    const originalText = submitBtn.innerText;
                    submitBtn.innerText = 'Sending...';

                    try {
                        // 1. Trigger Supabase Auth with double opt-in (Email Confirmation)
                        const { data: authData, error: authError } = await astroSupabase.auth.signUp({
                            email: email,
                            password: Math.random().toString(36).slice(-12),
                            options: {
                                data: {
                                    gdpr_consent: true,
                                    source: 'spaceholderz_site'
                                }
                            }
                        });

                        if (authError) throw authError;

                        // 2. record lead in table (if public permissions allow)
                        try {
                            await astroSupabase.from('leads').insert([{ email: email, gdpr_consent: true }]);
                        } catch (dbErr) {
                            console.warn('DB Insert skipped or failed:', dbErr.message);
                        }

                        // 3. Success State UI
                        document.getElementById('leadForm').style.display = 'none';
                        document.getElementById('successState').style.display = 'block';

                    } catch (err) {
                        console.error('Submission error:', err.message);
                        alert('Submission failed: ' + err.message);
                        submitBtn.disabled = false;
                        submitBtn.innerText = originalText;
                    }
                } else if (!astroSupabase) {
                    alert('Connection error (Supabase not loaded). Please check your internet or try again later.');
                }
            });
        }
    </script>
</body>

</html>